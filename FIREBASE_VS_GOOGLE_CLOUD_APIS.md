# Firebase vs Google Cloud APIs - Understanding the Difference

## TL;DR - Quick Answer âœ…

**No, adding Google Cloud API keys will NOT affect your Firebase!**

They're separate systems that work independently:
- **Firebase** = Backend services (auth, database, storage)
- **Google Cloud APIs** = Third-party APIs (TTS, YouTube, Books)

## How They Work Together

```
Your Flutter App
â”œâ”€â”€ Firebase Services (firebase_options.dart)
â”‚   â”œâ”€â”€ Authentication
â”‚   â”œâ”€â”€ Firestore Database
â”‚   â”œâ”€â”€ Cloud Storage
â”‚   â””â”€â”€ Cloud Messaging
â”‚
â””â”€â”€ Google Cloud APIs (api_config.dart)
    â”œâ”€â”€ Text-to-Speech API
    â”œâ”€â”€ YouTube Data API
    â””â”€â”€ Google Books API
```

## Two Separate Configuration Files

### 1. Firebase Configuration
**File**: `lib/firebase_options.dart`

- Auto-generated by FlutterFire CLI
- Contains Firebase project credentials
- Used for Firebase services only
- **DO NOT MODIFY THIS MANUALLY**

```dart
// Generated by FlutterFire
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    // Firebase project configuration
  }
}
```

### 2. Google Cloud API Keys
**File**: `lib/config/api_config.dart`

- You create and manage this file
- Contains API keys for Google Cloud services
- Separate from Firebase
- **YOU ADD YOUR KEYS HERE**

```dart
// Your API keys
class ApiConfig {
  static const String youtubeApiKey = 'YOUR_KEY';
  static const String textToSpeechApiKey = 'YOUR_KEY';
}
```

## How Your App Uses Both

### Example: Generating a Podcast

```dart
// Step 1: Firebase Auth (uses firebase_options.dart)
final user = FirebaseAuth.instance.currentUser;

// Step 2: Generate speech using Google Cloud TTS (uses api_config.dart)
final audioBytes = await TtsService.generateSpeechDirect(
  text: 'Hello!',
  // Uses ApiConfig.textToSpeechApiKey
);

// Step 3: Save to Firebase Storage (uses firebase_options.dart)
await FirebaseStorage.instance
  .ref('podcasts/${user.uid}/audio.mp3')
  .putData(audioBytes);

// Step 4: Save metadata to Firestore (uses firebase_options.dart)
await FirebaseFirestore.instance
  .collection('users/${user.uid}/podcasts')
  .add({...});
```

**See?** They work together but use different credentials!

## Security Comparison

| Aspect | Firebase | Google Cloud APIs |
|--------|----------|-------------------|
| **Configuration** | Auto-generated | You manage manually |
| **In .gitignore?** | No (safe to commit) | Yes (MUST ignore) |
| **Exposed in app?** | Yes (public config) | Yes (but restricted) |
| **Security** | Firebase Security Rules | API key restrictions |
| **Best Practice** | Use Security Rules | Use Cloud Functions |

## Best Practices for Text-to-Speech

I've set up **TWO approaches** for you:

### Approach 1: Direct API Call (Development)
âœ… **Pros:**
- Simpler to set up
- No Cloud Functions needed
- Good for testing

âŒ **Cons:**
- API key is in your app (can be extracted)
- Less secure for production
- Harder to monitor usage

**Use this for**: Development and testing

### Approach 2: Cloud Functions (Production) â­ RECOMMENDED
âœ… **Pros:**
- API key stays on server (secure!)
- Better error handling
- Easy to monitor and rate-limit
- Can store audio in Cloud Storage

âŒ **Cons:**
- Requires deploying Cloud Functions
- More setup initially

**Use this for**: Production deployment

## Setting Up Text-to-Speech

### Option 1: Direct API (Quick Start)

1. **Enable TTS API in Google Cloud**:
   - Go to [Google Cloud Console](https://console.cloud.google.com/)
   - Enable "Cloud Text-to-Speech API"
   - Create an API key
   - Restrict it to "Cloud Text-to-Speech API"

2. **Add key to config**:
   ```dart
   // lib/config/api_config.dart
   static const String textToSpeechApiKey = 'AIzaSyABC...';
   ```

3. **Use it in your app**:
   ```dart
   // It's already integrated in podcast_service.dart!
   final audioUrl = await generateDailyPodcast(mood, history);
   ```

4. **Run your app**:
   ```bash
   flutter pub get  # Get path_provider dependency
   flutter run
   ```

### Option 2: Cloud Functions (Production)

1. **Enable TTS API** (same as above)

2. **Update functions/index.js**:
   ```javascript
   const { generatePodcast } = require('./tts_cloud_function');
   exports.generatePodcast = generatePodcast;
   ```

3. **Deploy the function**:
   ```bash
   cd functions
   npm install  # Installs @google-cloud/text-to-speech
   cd ..
   firebase deploy --only functions
   ```

4. **Get your Cloud Functions URL**:
   - Go to Firebase Console > Functions
   - Copy the URL (e.g., `https://us-central1-your-project.cloudfunctions.net`)

5. **Add to config**:
   ```dart
   // lib/config/api_config.dart
   static const String cloudFunctionsUrl = 
     'https://us-central1-your-project.cloudfunctions.net';
   ```

6. **It automatically switches!**
   - If Cloud Functions URL is set â†’ Uses Cloud Functions âœ“
   - If not set â†’ Falls back to direct API call

## Common Questions

### Q: Do I need separate API keys for Firebase and Google Cloud APIs?
**A:** Yes! They're different:
- Firebase uses project configuration (firebase_options.dart)
- Google Cloud APIs use API keys (api_config.dart)

### Q: Can I use the same Google Cloud project for both?
**A:** Yes! In fact, Firebase IS a Google Cloud project. You can enable additional APIs in the same project.

### Q: Will using TTS API cost money?
**A:** Free tier includes:
- 1 million characters/month (Standard voices)
- 1 million characters/month (WaveNet voices - first year only)
- After that, pricing varies by voice type

### Q: What if I exceed the free quota?
**A:** You'll need to enable billing. Firebase will alert you. Set up budget alerts!

### Q: Which approach should I use?
**A:** 
- **For learning/development**: Direct API (easier)
- **For production app**: Cloud Functions (more secure)

### Q: Can I switch between approaches later?
**A:** Yes! The code automatically detects which one to use based on your configuration.

## File Structure Summary

```
/Users/tylin/Soar/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ firebase_options.dart          # Firebase config (auto-generated)
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ api_config.dart            # Your API keys (in .gitignore)
â”‚   â”‚   â””â”€â”€ api_config.example.dart    # Template (safe to share)
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ podcast_service.dart       # Uses both Firebase & TTS
â”‚       â””â”€â”€ tts_service.dart          # TTS API wrapper (NEW!)
â”‚
â”œâ”€â”€ functions/
â”‚   â”œâ”€â”€ index.js                       # Firebase Functions entry
â”‚   â”œâ”€â”€ tts_cloud_function.js         # TTS Cloud Function (NEW!)
â”‚   â””â”€â”€ package.json                   # Includes @google-cloud/text-to-speech
â”‚
â””â”€â”€ .gitignore                         # Excludes api_config.dart âœ“
```

## Next Steps

1. **Add your TTS API key** to `lib/config/api_config.dart`
2. **Install dependencies**: `flutter pub get`
3. **Test direct approach**: Run your app
4. **Deploy Cloud Function** (optional, for production):
   ```bash
   cd functions
   npm install
   cd ..
   firebase deploy --only functions
   ```
5. **Add Cloud Functions URL** to `api_config.dart`

## Testing Your Setup

```dart
// Test if TTS is configured
if (TtsService.isConfigured) {
  print('âœ… TTS API is ready!');
  
  // Generate a test audio
  final audio = await TtsService.generateSpeechDirect(
    text: 'Hello from SOAR!',
  );
  
  if (audio != null) {
    print('âœ… TTS working! Audio size: ${audio.length} bytes');
  }
}
```

---

**Remember**: Firebase and Google Cloud APIs are teammates, not competitors! They work together to power your app. ðŸš€

